<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>TACTIX</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 text-gray-800">
    <header class="bg-white border-b">
      <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
        <div class="text-sm text-gray-600">
          <span class="font-semibold">TCTH</span>
          <span class="mx-2">&gt;</span>
          <span>Common Operating Picture</span>
          <span class="mx-2">&gt;</span>
          <span class="font-semibold">OP LENTUS 25-01</span>
        </div>
        <div class="flex items-center gap-4 text-sm">
          <a href="#" class="text-blue-600 hover:underline">Virtual Diary Viewer</a>
          <a href="#" class="text-blue-600 hover:underline">Mission Playback</a>
          <a href="#" class="text-blue-600 hover:underline">Manage Messages</a>
        </div>
      </div>
    </header>

    <main class="max-w-7xl mx-auto p-4 flex gap-4">
      <!-- Left column -->
      <aside class="w-64 space-y-4">
        <section class="bg-white rounded shadow p-4">
          <h2 class="text-lg font-semibold mb-2">Navigator</h2>
          <div class="space-y-2 text-sm">
            <div>
              <label class="block font-medium">Campaign</label>
              <select id="campaign-select" class="mt-1 w-full border rounded p-1"></select>
            </div>
            <div>
              <label class="block font-medium">Operation</label>
              <select id="operation-select" class="mt-1 w-full border rounded p-1"></select>
            </div>
            <div>
              <label class="block font-medium">Unit</label>
              <select id="unit-select" class="mt-1 w-full border rounded p-1"></select>
            </div>
          </div>
        </section>
        <section class="bg-white rounded shadow p-4">
          <h2 class="text-lg font-semibold mb-2">Ongoing Incident</h2>
          <p class="text-sm">IR2024-NR Incident Report C003</p>
        </section>
        <section class="bg-white rounded shadow p-4">
          <h2 class="text-lg font-semibold mb-2">Draft Reports</h2>
          <ul class="text-sm list-disc pl-4">
            <li>Consolidated Sitrep to 5DGMBC</li>
          </ul>
        </section>
        <section class="bg-white rounded shadow p-4">
          <h2 class="text-lg font-semibold mb-2">CloudTAK Wiki</h2>
          <p class="text-sm">A centralized knowledge base for guides, tools, and best practices across the CloudTAK ecosystem.</p>
        </section>
      </aside>

      <!-- Main content -->
      <div class="flex-1 space-y-4">
        <section class="bg-white rounded shadow p-4">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg font-semibold">Warlog</h2>
            <button class="bg-blue-600 text-white text-sm px-3 py-1 rounded">Save</button>
          </div>
          <ul id="warlog" class="space-y-4 text-sm"></ul>
        </section>

        <div class="flex gap-4">
          <section class="flex-1 bg-white rounded shadow p-4">
            <h2 class="text-lg font-semibold mb-2">Quick Warlog Entry</h2>
            <textarea class="w-full h-32 border rounded p-2 text-sm" placeholder="Enter log entry..."></textarea>
            <div class="mt-2 text-right">
              <button class="bg-blue-600 text-white text-sm px-3 py-1 rounded">Save</button>
            </div>
          </section>
          <section class="flex-1 bg-white rounded shadow p-4 flex flex-col">
            <h2 class="text-lg font-semibold mb-2">Live Chat</h2>
            <div id="chat-info" class="text-xs text-gray-500 mb-2"></div>
            <div id="chat-log" class="flex-1 border rounded p-2 bg-black text-green-200 text-xs overflow-y-auto mb-2"></div>
            <input id="chat-input" type="text" class="border rounded p-2 text-sm" placeholder="Chat..." />
          </section>
        </div>
      </div>
    </main>
  </body>
  <script>
    async function loadOperation(opId) {
      const res = await fetch(`/api/operations/${opId}`);
      const data = await res.json();

      const warlogEl = document.getElementById('warlog');
      warlogEl.innerHTML = '';
      data.warlog.forEach(entry => {
        const li = document.createElement('li');
        li.innerHTML = `<div class="font-medium">${entry.author || 'Unknown'} <span class="text-xs text-gray-500">${new Date(entry.ts).toISOString()}</span></div><p class="text-gray-700">${entry.message}</p>`;
        warlogEl.appendChild(li);
      });

      const chatInfo = document.getElementById('chat-info');
      chatInfo.textContent = `XMPP: ${data.operation.xmpp_host || ''} ${data.operation.xmpp_room || ''}`;

      const unitSelect = document.getElementById('unit-select');
      unitSelect.innerHTML = '';
      data.units.forEach(u => {
        const opt = document.createElement('option');
        opt.value = u.id;
        opt.textContent = u.name;
        unitSelect.appendChild(opt);
      });

      const operationSelect = document.getElementById('operation-select');
      operationSelect.innerHTML = `<option value="${data.operation.id}">${data.operation.name}</option>`;

      const campaignSelect = document.getElementById('campaign-select');
      campaignSelect.innerHTML = `<option value="${data.operation.campaign_id}">Campaign ${data.operation.campaign_id}</option>`;
    }

    document.addEventListener('DOMContentLoaded', () => loadOperation(1));
  </script>
</html>

